# EspacoTherapyKids

API RESTful (Spring Boot) + Front-end (React/Vite) para gest√£o de pacientes do Espa√ßo Therapy Kids.  
Inclui CRUD completo, valida√ß√£o, respostas padronizadas, Swagger/OpenAPI e integra√ß√£o com Oracle DB.

## üöÄ Stack

- **Back-end:** Java 17, Spring Boot 3, JDBC (Oracle), Bean Validation, Springdoc OpenAPI  
- **Front-end:** React + Vite, Formik/Yup, styled-components  
- **Banco:** Oracle (XE ou Standard), driver `ojdbc8`  
- **Auth m√≠nima:** login com usu√°rio/senha fixos ‚Üí emiss√£o de token Bearer (TokenService)

---

## üìÅ Estrutura (simplificada)

```
EspacoTherapyKids/
‚îú‚îÄ EspacoTherapyKidsBackend/
‚îÇ  ‚îú‚îÄ src/main/java/org/example/
‚îÇ  ‚îÇ  ‚îú‚îÄ controller/ (PacienteController, AuthController)
‚îÇ  ‚îÇ  ‚îú‚îÄ dao/ (PacienteDao)
‚îÇ  ‚îÇ  ‚îú‚îÄ model/ (Paciente, Sessao)
‚îÇ  ‚îÇ  ‚îú‚îÄ dto/ (PacienteRequestDTO, PacienteResponseDTO, SessaoDTO, PageResponse, PacienteMapper)
‚îÇ  ‚îÇ  ‚îú‚îÄ web/ (GlobalExceptionHandler, ApiError)
‚îÇ  ‚îÇ  ‚îú‚îÄ config/ (WebConfig)  # JacksonConfig opcional
‚îÇ  ‚îÇ  ‚îî‚îÄ EspacoTherapyKidsApplication.java
‚îÇ  ‚îî‚îÄ src/main/resources/application.properties
‚îî‚îÄ EspacoTherapyKidsFrontend/ (React/Vite)
   ‚îú‚îÄ src/
   ‚îî‚îÄ package.json 
```

> Se o front estiver dentro do mesmo reposit√≥rio, ajuste os caminhos conforme sua organiza√ß√£o.

---

## ‚úÖ Pr√©-requisitos

- **JDK 17**  
- **Maven 3.9+**  
- **Node 18+** (ou 20+)  
- **Oracle** em execu√ß√£o (ex.: **Oracle XE** local)

---

## üóÉÔ∏è Banco de Dados (DDL)

Crie a tabela conforme o DAO utiliza (nomes/colunas **devem** bater):

```sql
CREATE TABLE tb_paciente (
  cd_paciente      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nr_responsavel   NUMBER(15),
  nm_responsavel   VARCHAR2(120),
  nm_paciente      VARCHAR2(120),

  preco_fono       NUMBER(10,2),
  horas_fono       NUMBER(5),
  total_fono       NUMBER(12,2),
  reembolso_fono   NUMBER(10,2),
  nf_fono          NUMBER(6),

  preco_to         NUMBER(10,2),
  horas_to         NUMBER(5),
  total_to         NUMBER(12,2),
  reembolso_to     NUMBER(10,2),
  nf_to            NUMBER(6),

  preco_aba        NUMBER(10,2),
  reembolso_aba    NUMBER(10,2),
  nf_aba           NUMBER(6)
);
```

> Se sua vers√£o do Oracle n√£o suportar `IDENTITY`, crie `SEQUENCE + TRIGGER` de PK.

---

## ‚öôÔ∏è Configura√ß√£o do Back-end

Edite `EspacoTherapyKidsBackend/src/main/resources/application.properties`:

```properties
# Porta
server.port=8080

# Oracle
spring.datasource.url=jdbc:oracle:thin:@localhost:1521/XEPDB1
spring.datasource.username=SEU_USUARIO
spring.datasource.password=SUA_SENHA
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# Jackson (Java time)
spring.jackson.serialization.write-dates-as-timestamps=false

# Swagger/OpenAPI (Springdoc)
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true

# CORS (tamb√©m h√° WebConfig liberando http://localhost:5173)
# Ajuste se necess√°rio
```

> **Encoding:** salve `application.properties` em **UTF-8**.  
> Em IDEs que n√£o oferecem a escolha, garanta que n√£o h√° caracteres ‚Äúestranhos‚Äù.

### Usu√°rio e Senha do Login

No `AuthController`, o login m√≠nimo est√° fixo como:

```
username: system
password: admin
```

Voc√™ pode trocar no pr√≥prio `AuthController` (compara√ß√£o simples) e/ou ajustar o `TokenService` se estiver lendo `secret` via propriedades.

---

## ‚ñ∂Ô∏è Rodando o Back-end

Na pasta `EspacoTherapyKidsBackend`:

```bash
# build
mvn clean package

# execute direto
mvn spring-boot:run

# ou via jar
java -jar target/EspacoTherapyKidsBackend-1.0-SNAPSHOT.jar
```

Se tudo ok: `http://localhost:8080/swagger-ui/index.html`

---

## üß™ Swagger (testes r√°pidos)

1. Abra `http://localhost:8080/swagger-ui/index.html`.
2. Fa√ßa **login**:
   - POST `/api/auth/login`  
     Body:
     ```json
     { "username": "system", "password": "admin" }
     ```
   - Resposta:
     ```json
     { "tokenType": "Bearer", "accessToken": "..." }
     ```
3. Clique em **Authorize** (cadeado no topo) ‚Üí Cole **`Bearer SEU_TOKEN`** ‚Üí Authorize.

### Endpoints principais

- **POST** `/api/pacientes` (cadastrar)  
  Exemplo de body:
  ```json
  {
    "nrResponsavel": 11987654321,
    "nmResponsavel": "Joao Silva",
    "nome": "Ana Clara",
    "fono": { "preco": 120, "horas": 2, "reembolsoInformado": 80 },
    "terapiaOcupacional": { "preco": 100, "horas": 1, "reembolsoInformado": 70 },
    "aba": { "preco": 150, "horas": 1, "reembolsoInformado": 90 }
  }
  ```

- **GET** `/api/pacientes` (listar com filtros/pagina√ß√£o/ordena√ß√£o)  
  Query params: `nome`, `nmResponsavel`, `page`, `size`, `sortBy`, `sortDir`

- **GET** `/api/pacientes/{id}` (pesquisar)
- **PUT** `/api/pacientes/{id}` (atualizar)
- **DELETE** `/api/pacientes/{id}` (remover)

---

## üåê Configura√ß√£o do Front-end

Na pasta do front (ex.: `EspacoTherapyKidsFrontend`):

1. Instale e rode:
   ```bash
   npm install
   npm run dev
   ```
   Acesse **http://localhost:5173**

2. Primeiro **login** na UI:
   - Usu√°rio: `system`
   - Senha: `admin`

---

## üìö Valida√ß√£o, Pagina√ß√£o e Erros Padronizados

- **Valida√ß√£o (422):** Bean Validation nos DTOs (`@Valid`) com `fieldErrors` no corpo da resposta.
- **Pagina√ß√£o:** `GET /api/pacientes` retorna `PageResponse` (`content`, `page`, `size`, `totalElements`, `totalPages`).
- **Erros padronizados:** `ApiError` sempre retorna `timestamp, path, status, error, code, message` (+ `fieldErrors` quando aplic√°vel).
- **SQL (Oracle):** `GlobalExceptionHandler` devolve mensagem detalhada com `ORA-xxxxx` em erros de banco.

---
